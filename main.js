(()=>{"use strict";class e{constructor({data:e,handleCardClick:t,handleCardDelete:s,handleCardAddLike:o,handleCardRemoveLike:i,userId:n},r){this._userId=n,this._name=e.name,this._link=e.link,this._likes=e.likes,this._cardId=e._id,this._ownerId=e.owner._id,this._templateSelector=r,this._handleCardClick=t,this._handleCardDelete=s,this._handleCardAddLike=o,this._handleCardRemoveLike=i}_getTemplate=()=>document.querySelector(this._templateSelector).content.cloneNode(!0);_setTrashSignEventListener=()=>{this._element.querySelector(".photo__delete").addEventListener("click",(e=>{this._handleCardDelete(this._cardId,this)}))};_setLikeButtonEventListener=()=>{this._likeBtn.addEventListener("click",(e=>{e.target.classList.contains("photo__like_active")?this._handleCardRemoveLike(this._cardId,this):this._handleCardAddLike(this._cardId,this),e.target.classList.toggle("photo__like_active")}))};_setImageClickEventListener=()=>{this._photoImage=this._element.querySelector(".photo__image"),this._photoImage.addEventListener("click",(()=>{this._handleCardClick(this._name,this._link)}))};_setEventListeners=()=>{this._setImageClickEventListener(),this._setLikeButtonEventListener(),this._setTrashSignEventListener()};setLikesCount=e=>{this._likesCounter.textContent=e};deleteCard=()=>{this._photo.remove()};generateCard=()=>(this._element=this._getTemplate(),this._likesCounter=this._element.querySelector(".photo__like-counter"),this._likeBtn=this._element.querySelector(".photo__like"),this._setEventListeners(),this._photoImage.src=this._link,this._photoImage.alt=this._name,this._photo=this._element.querySelector(".photo"),this.setLikesCount(this._likes.length),this._element.querySelector(".photo__description").textContent=this._name,this._userId!==this._ownerId&&(this._element.querySelector(".photo__delete").style.display="none"),-1!=this._likes.findIndex((e=>e._id===this._userId))&&this._likeBtn.classList.add("photo__like_active"),this._element)}class t{constructor(e,t){this._config=e,this._form=t,this._inputList=Array.from(this._form.querySelectorAll(this._config.inputSelector)),this._button=this._form.querySelector(this._config.submitButtonSelector)}_showError(e){const t=this._form.querySelector(`#${e.id}-error`);e.classList.add(this._config.inputErrorClass),t.textContent=e.validationMessage,t.classList.add(this._config.errorClass)}_hideError(e){const t=this._form.querySelector(`#${e.id}-error`);e.classList.remove(this._config.inputErrorClass),t.textContent="",t.classList.remove(this._config.errorClass)}_checkInputValidity(e){e.validity.valid?this._hideError(e):this._showError(e)}_hasInvalidInput(){return this._inputList.some((e=>!e.validity.valid))}_toggleButtonState(e){e?(this._button.classList.remove(this._config.inactiveButtonClass),this._button.disabled=!1):(this._button.classList.add(this._config.inactiveButtonClass),this._button.disabled=!0)}_setEventListeners(){const e=this;this._inputList.forEach((function(t){t.addEventListener("input",(function(){e._checkInputValidity(t),e._toggleButtonState(!e._hasInvalidInput())}))}))}enableValidation(){this._form.addEventListener("submit",(function(e){e.preventDefault()})),this._setEventListeners()}resetValidation(e){this._toggleButtonState(e),this._inputList.forEach((e=>{this._hideError(e)})),this._form.reset()}}class s{constructor(e){this._popupElement=document.querySelector(e)}open(){this.setEventListeners(),this._popupElement.classList.add("popup_opened")}close(){document.removeEventListener("keydown",this._handleEscClose),document.removeEventListener("click",this._handleOverlayClose),this._popupElement.removeEventListener("click",this._handleCloseByCloseBtn),this._popupElement.classList.remove("popup_opened")}setEventListeners(){document.addEventListener("keydown",this._handleEscClose),document.addEventListener("click",this._handleOverlayClose),this._popupElement.addEventListener("click",this._handleCloseByCloseBtn)}_handleEscClose=e=>{"Escape"===e.key&&this.close()};_handleOverlayClose=e=>{e.target.classList.contains("popup")&&this.close()};_handleCloseByCloseBtn=e=>{e.target.classList.contains("popup__close-btn")&&this.close()}}class o extends s{constructor(e,{formSubmit:t}){super(e),this._formSubmit=t,this._popupForm=this._popupElement.querySelector(".popup__form"),this._inputList=this._popupElement.querySelectorAll(".popup__input"),this._submitButton=this._popupElement.querySelector(".popup__save-btn")}setEventListeners(){this._popupForm.addEventListener("submit",this._handleFormSubmit),super.setEventListeners()}toggleButtonText(){"Сохранить"===this._submitButton.textContent?this._submitButton.textContent="Сохранение...":this._submitButton.textContent="Сохранить"}close(){this._popupForm.removeEventListener("submit",this._handleFormSubmit),this._popupForm.reset(),super.close()}_getInputValues(){return this._inputValues={},this._inputList.forEach((e=>{this._inputValues[e.name]=e.value})),this._inputValues}_handleFormSubmit=e=>{e.preventDefault(),this._formSubmit(this._getInputValues())}}const i=document.querySelector(".profile__edit-btn"),n=document.querySelector(".profile__add-btn"),r=document.querySelector(".profile__edit-pen"),a=document.querySelector(".popup_type_edit-profile"),l=a.querySelector(".popup__form"),h=document.querySelector(".popup_type_edit-avatar"),p=h.querySelector(".popup__form"),_=a.querySelector("#popup__input_content_name"),c=a.querySelector("#popup__input_content_activity"),u=h.querySelector("#popup__input_content_avatar"),d=document.querySelector(".popup_type_add-photo").querySelector(".popup__form"),m={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__save-btn",closeButtonSelector:".popup__close-btn",inactiveButtonClass:"popup__save-btn_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},v={baseUrl:"https://mesto.nomoreparties.co/v1/cohort-28",token:"293a0c2f-5c40-49bf-a976-5ae5443f2d33",userId:"f16a34b5394cfefae4df8840"},f=new class{constructor(e){this._baseUrl=e.baseUrl,this._token=e.token}getProfileInfo(){return fetch(`${this._baseUrl}/users/me`,{method:"GET",headers:{authorization:`${this._token}`,"Content-Type":"application/json"}}).then((e=>e.ok?e.json():Promise.reject(e.status+" "+e.statusText)))}editProfile(e,t){return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:{authorization:`${this._token}`,"Content-Type":"application/json"},body:JSON.stringify({name:`${e}`,about:`${t}`})}).then((e=>e.ok?e.json():Promise.reject(e.status+" "+e.statusText)))}editAvatar(e){return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:{authorization:`${this._token}`,"Content-Type":"application/json"},body:JSON.stringify({avatar:`${e}`})}).then((e=>e.ok?e.json():Promise.reject(e.status+" "+e.statusText)))}getInitialCards(){return fetch(`${this._baseUrl}/cards`,{method:"GET",headers:{authorization:`${this._token}`,"Content-Type":"application/json"}}).then((e=>e.ok?e.json():Promise.reject(e.status+" "+e.statusText)))}addCard(e,t){return fetch(`${this._baseUrl}/cards`,{method:"POST",headers:{authorization:`${this._token}`,"Content-Type":"application/json"},body:JSON.stringify({name:`${e}`,link:`${t}`})}).then((e=>e.ok?e.json():Promise.reject(e.status+" "+e.statusText)))}deleteCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:{authorization:`${this._token}`,"Content-Type":"application/json"}}).then((e=>e.ok?e.json():Promise.reject(e.status+" "+e.statusText)))}addLike(e){return fetch(`${this._baseUrl}/cards/likes/${e}`,{method:"PUT",headers:{authorization:`${this._token}`,"Content-Type":"application/json"}}).then((e=>e.ok?e.json():Promise.reject(e.status+" "+e.statusText)))}removeLike(e){return fetch(`${this._baseUrl}/cards/likes/${e}`,{method:"DELETE",headers:{authorization:`${this._token}`,"Content-Type":"application/json"}}).then((e=>e.ok?e.json():Promise.reject(e.status+" "+e.statusText)))}_handleServerResponse(e){return e.ok?e.json():Promise.reject(e.status+" "+e.statusText)}}(v),y=new class{constructor(e,t,s){this._nameField=document.querySelector(e),this._activityField=document.querySelector(t),this._avatar=document.querySelector(s)}getUserInfo(){return{name:this._nameField.textContent,activity:this._activityField.textContent,avatar:this._avatar.src}}setUserInfo(e){this._nameField.textContent=e.name,this._activityField.textContent=e.about}setUserAvatar(e){this._avatar.src=e.avatar}}(".profile__name",".profile__activity",".profile__avatar");f.getProfileInfo().then((e=>{y.setUserInfo(e),y.setUserAvatar(e)})).catch((e=>console.error(e)));const C=new o(".popup_type_edit-profile",{formSubmit:e=>{C.toggleButtonText(),f.editProfile(e.name,e.activity).then((e=>{y.setUserInfo(e)})).catch((e=>console.error(e))).finally((()=>{C.close(),C.toggleButtonText()}))}}),k=new o(".popup_type_edit-avatar",{formSubmit:e=>{k.toggleButtonText(),f.editAvatar(e.avatar).then((e=>{y.setUserAvatar(e)})).catch((e=>console.error(e))).finally((()=>{k.close(),k.toggleButtonText()}))}}),L=new class{constructor({renderer:e},t){this._renderer=e,this._container=document.querySelector(t)}addItem(e){this._container.prepend(e)}renderItems(e){e.forEach((e=>{this._renderer(e)}))}}({renderer:e=>{const t=b(e);L.addItem(t)}},".photos");f.getInitialCards().then((e=>{L.renderItems(e)})).catch((e=>console.error(e)));const E=new o(".popup_type_add-photo",{formSubmit:e=>{f.addCard(e.name,e.link).then((e=>{const t=b(e);L.addItem(t)})).catch((e=>console.error(e))).finally(E.close())}}),g=new class extends s{constructor(e){super(e),this._popupImage=this._popupElement.querySelector(".popup__photo"),this._popupDescription=this._popupElement.querySelector(".popup__photo-description")}open(e,t){this._popupDescription.textContent=e,this._popupImage.src=t,this._popupImage.alt=e,super.open()}close(){super.close(),this._popupImage.src="",this._popupDescription.textContent=""}}(".popup_type_view-photo"),S=new class extends s{constructor(e,{confirmDelete:t}){super(e),this._confirmDelete=t,this._popupForm=this._popupElement.querySelector(".popup__form")}open(e,t){this._cardId=e,this._card=t,super.open()}setEventListeners(){this._popupForm.addEventListener("submit",this._handleConfirmDelete),super.setEventListeners()}close(){this._popupForm.removeEventListener("submit",this._handleConfirmDelete),super.close()}_handleConfirmDelete=e=>{e.preventDefault(),this._confirmDelete(this._cardId,this._card)}}(".popup_type_delete-photo",{confirmDelete:(e,t)=>{f.deleteCard(e).then((e=>{t.deleteCard()})).catch((e=>console.error(e))).finally(S.close())}});function b(t){return new e({data:t,handleCardClick:(e,t)=>{g.open(e,t)},handleCardDelete:(e,t)=>{S.open(e,t)},handleCardAddLike:(e,t)=>{f.addLike(e).then((e=>{t.setLikesCount(e.likes.length)})).catch((e=>console.error(e)))},handleCardRemoveLike:(e,t)=>{f.removeLike(e).then((e=>{t.setLikesCount(e.likes.length)})).catch((e=>console.error(e)))},userId:v.userId},"#photo-template").generateCard()}const I=new t(m,l);I.enableValidation();const q=new t(m,p);q.enableValidation();const T=new t(m,d);T.enableValidation(),i.addEventListener("click",(()=>{I.resetValidation(!0),_.value=y.getUserInfo().name,c.value=y.getUserInfo().activity,C.open()})),r.addEventListener("click",(()=>{q.resetValidation(!0),u.value=y.getUserInfo().avatar,k.open()})),n.addEventListener("click",(()=>{T.resetValidation(!1),E.open()}))})();